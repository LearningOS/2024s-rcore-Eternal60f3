#### 实现的功能

+ 加入了`mmap`和`munmap`系统调用那个

+ 对于上一节的`sys_get_time`和`sys_task_info`系统调用涉及到的地址空间隔离进行完善
  + 当传入的指针指向的数据横跨两个页面的时候，会直接panic



#### 请列举 SV39 页表页表项的组成，描述其中的标志位有何作用？

1. ppn
2. V(Valid)：仅当位 V 为 1 时，页表项才是合法的；
3. R(Read)/W(Write)/X(eXecute)：分别控制索引到这个页表项的对应虚拟页面是否允许读/写/执行；
4. U(User)：控制索引到这个页表项的对应虚拟页面是否在 CPU 处于 U 特权级的情况下是否被允许访问；
5. G：暂且不理会；
6. A(Accessed)：处理器记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被访问过；
7. D(Dirty)：处理器记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被修改过。



#### 缺页

1. 请问哪些异常可能是缺页导致的？
   + 答案：访存异常
2. 发生缺页时，描述相关重要寄存器的值，上次实验描述过的可以简略。
   + 答案：satp改为内核地址，stvec 改为处理内核异常程序地址
3. 缺页有两个常见的原因，其一是 Lazy 策略，也就是直到内存页面被访问才实际进行页表操作。 比如，一个程序被执行时，进程的代码段理论上需要从磁盘加载到内存。但是 os 并不会马上这样做， 而是会保存 .text 段在磁盘的位置信息，在这些代码第一次被执行时才完成从磁盘的加载操作。
   1. 有哪些好处
      + 答案：用户程序堆栈内存空间，虽然一开始申请了很大，但是有可能实际用不到那么多，并且.text段也可能在运行过程中就被exit了，后续代码没有运行，也就没必要放入内存空间
   2. 处理 10G 连续的内存页面，对应的 SV39 页表大致占用多少内存 (估算数量级即可)？
      + 答案：10GB / 512B = 10 * 2^22 B = 40MB
   3. 请简单思考如何才能实现 Lazy 策略，缺页时又如何处理？描述合理即可，不需要考虑实现。
      + 答案：在新建一个task的时候只加载虚拟地址，但不map。同时加入一个异常，如果当前访问的虚拟地址没有map的时候，就进入trap调用，将该地址与对应的物理地址map
   4. 此时页面失效如何表现在页表项(PTE)上？
      + 答案：A 标志位
4. 为了防范侧信道攻击，我们的 os 使用了双页表。但是传统的设计一直是单页表的，也就是说， 用户线程和对应的内核线程共用同一张页表，只不过内核对应的地址只允许在内核态访问。 (备注：这里的单/双的说法仅为自创的通俗说法，并无这个名词概念，详情见 [KPTI](https://en.wikipedia.org/wiki/Kernel_page-table_isolation) )
   1. 在单页表情况下，如何更换页表？
      + 答案：用户态和内核态切换到时候无需更换，切换任务的时候更换satp寄存器的值即可，这个过程还涉及到保存trap任务流状态需要保存
   2. 单页表情况下，如何控制用户态无法访问内核页面？
      + 查看PTE的U位是否置1，如无则禁止访问
   3. 单页表有何优势？
      + 优势：对于频繁使用系统调用的task来说，减少了切换地址空间时，清空TLB所带来的时间损耗
      + 劣势：当需要频繁切换人物的时候，上面减少的代价在这里偿还回来了
   4. 双页表实现下，何时需要更换页表？
      + 内核态和用户态切换的时候
   5. 假设你写一个单页表操作系统，你会选择何时更换页表？
      + 任务切换的时候



#### 荣誉准则

1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 **以下各位** 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

   > 无

2. 此外，我也参考了 **以下资料** ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

   > rcore-v3, rcore-2024这两个文档

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。